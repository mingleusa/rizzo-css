---
import { DOCS_NAV } from '../config/docsNav';
import type { Framework } from '../config/frameworks';

interface Props {
  currentPath: string;
  framework: Framework;
  /** When true, omit the aside id to avoid duplicate ids when used inside a demo box on the same page. */
  omitId?: boolean;
}

const { currentPath, framework, omitId } = Astro.props;
const pathPrefix = framework.pathPrefix; // /docs or /docs/svelte or /docs/vanilla

function fullHref(link: { href: string; frameworkOnly?: boolean }) {
  const base = link.frameworkOnly ? pathPrefix : '/docs';
  return `${base}/${link.href}`;
}

/** Active only when the current path exactly matches this link (no parent/child). */
function isActive(link: { href: string; frameworkOnly?: boolean }): boolean {
  const path = currentPath.replace(/\/$/, '');
  const href = fullHref(link);
  return path === href;
}
---

<aside {...(omitId ? {} : { id: 'docs-sidebar' })} class="docs-sidebar" aria-label="Documentation navigation" tabindex="0">
  <nav class="docs-sidebar__nav">
    {DOCS_NAV.map((group) => (
      <div class="docs-sidebar__group">
        <h2 class="docs-sidebar__group-label">{group.label}</h2>
        <ul class="docs-sidebar__list">
          {group.links.map((link) => {
            const href = fullHref(link);
            const active = isActive(link);
            return (
              <li class="docs-sidebar__item">
                <a
                  href={href}
                  class={`docs-sidebar__link ${active ? 'docs-sidebar__link--active' : ''}`}
                >
                  {link.label}
                </a>
              </li>
            );
          })}
        </ul>
      </div>
    ))}
  </nav>
</aside>
