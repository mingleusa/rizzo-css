---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import SearchComponent from '../../../components/Search.astro';
import CodeBlock from '../../../components/CodeBlock.astro';
import AddComponentTabs from '../../../components/AddComponentTabs.astro';
import FrameworkCodeTabs from '../../../components/FrameworkCodeTabs.astro';
---

<DocsLayout title="Search Component — Astro" description="Search component with Algolia integration and live filtering">
	<section>
		<h2>Search Component</h2>
		<p>An accessible search component that ships <strong>local search by default</strong> (client-side index, no backend). You can optionally hook up <strong>Algolia</strong> for hosted search, analytics, and better relevance; when Algolia is configured, the component uses it first and falls back to local search on network errors or if Algolia is unavailable. The <strong>package scaffold</strong> (when you add Search via the CLI) ships local/static search only: overlay with header (search icon, input, close button), focus trap, click-outside and Escape to close, and example result links you can edit.</p>
		<AddComponentTabs componentName="Search" />
	</section>
	
	<section>
		<h2>Features</h2>
		<ul>
			<li><strong>Full-screen overlay</strong> - When open, the overlay covers the viewport; the search modal is centered inside it both horizontally and vertically</li>
			<li>Optional Algolia with local search fallback (search and click analytics when Algolia is enabled)</li>
			<li>Keyboard shortcut - <kbd>Ctrl+K</kbd> / <kbd>Cmd+K</kbd> to open</li>
			<li>Close button on desktop (X icon with screen reader label)</li>
			<li>Close button on mobile with text label</li>
			<li>Live search results as you type</li>
			<li>Full keyboard navigation (Arrow keys, Enter, Escape, Tab)</li>
			<li>Mobile responsive - Full-width panel on mobile</li>
			<li>Mutually exclusive with mobile menu (only one open at a time)</li>
			<li>Accessible - ARIA attributes and screen reader support</li>
		</ul>
	</section>
	
	<section>
		<h2>Live example</h2>
		<p>Search is in the navbar (top of page) — click the search icon or press <kbd>Ctrl+K</kbd> / <kbd>Cmd+K</kbd>. You can also use the standalone search below.</p>
		<div class="example">
			<div class="example-title">Standalone search (same as navbar)</div>
			<div class="search-doc-example">
				<SearchComponent />
			</div>
		</div>
	</section>
	
	<section>
		<h2>Usage</h2>
		<p>Search script runs after DOM ready. Ctrl+K / Cmd+K opens it when the component is on the page.</p>
		<FrameworkCodeTabs
			astro={`---
import Search from '../components/rizzo/Search.astro';
---

<Search id="search-main" />

<!-- With Algolia: useAlgolia={true} algoliaAppId="..." algoliaApiKey="..." algoliaIndexName="..." -->`}
			svelte={`<script>
  import { Search } from '$lib/rizzo';
</script>

<Search id="search-main" />`}
			vanilla={`<!-- Shipped Navbar includes Search; standalone below. Include js/main.js for open/close, focus trap, click-outside. -->
<div class="search" data-search>
  <div class="search__trigger-wrapper">
    <button type="button" class="search__trigger" aria-label="Open search" aria-expanded="false" aria-controls="search-panel">
      <span class="search__trigger-text">Search</span>
    </button>
  </div>
  <div class="search__overlay" id="search-panel" aria-hidden="true" role="dialog" aria-modal="true" data-search-overlay>
    <div class="search__panel">
      <input type="search" class="search__input" placeholder="Search…" aria-label="Search" />
      <div class="search__results" role="listbox" aria-label="Search results">
        <div class="search__empty">
          <p class="search__empty-text">Start typing to search…</p>
        </div>
        <div class="search__results-list" role="group" aria-label="Sample results">
          <a href="#" class="search__result-item" tabindex="-1"><div class="search__result-category">Docs</div><div class="search__result-title">Getting started</div></a>
          <a href="#" class="search__result-item" tabindex="-1"><div class="search__result-category">Docs</div><div class="search__result-title">Components</div></a>
          <a href="#" class="search__result-item" tabindex="-1"><div class="search__result-category">Docs</div><div class="search__result-title">Theming</div></a>
        </div>
      </div>
    </div>
  </div>
</div>`}
		/>
	</section>
	
	<section>
		<h2>Props</h2>
		<ul>
			<li><code>useAlgolia</code> (boolean, optional) - Enable Algolia search (default: <code>false</code>)</li>
			<li><code>algoliaAppId</code> (string, optional) - Algolia Application ID</li>
			<li><code>algoliaApiKey</code> (string, optional) - Algolia Search-Only API Key</li>
			<li><code>algoliaIndexName</code> (string, optional) - Algolia index name (default: <code>"rizzo-css-docs"</code>)</li>
		</ul>
	</section>
	
	<section>
		<h2>Keyboard Shortcuts</h2>
		<ul>
			<li><kbd>Ctrl+K</kbd> / <kbd>Cmd+K</kbd> - Open/close search</li>
			<li><kbd>Escape</kbd> - Close search</li>
			<li><kbd>Arrow Down</kbd> - Navigate to next result</li>
			<li><kbd>Arrow Up</kbd> - Navigate to previous result</li>
			<li><kbd>Enter</kbd> - Navigate to selected result</li>
		</ul>
	</section>
	
	<section>
		<h2>Optional: Hook up Algolia</h2>
		<p>By default, Search uses a <strong>local client-side index</strong> (no API keys, works offline). To use Algolia for hosted search, analytics, and better relevance, follow these steps. When Algolia is configured, Search uses it first and automatically falls back to local search on errors or if the network fails.</p>
		
		<h3>1. Create an Algolia application</h3>
		<ul>
			<li>Sign up at <a href="https://www.algolia.com/" target="_blank" rel="noopener noreferrer">algolia.com<span class="sr-only"> (opens in new tab)</span></a></li>
			<li>Create a new application and note your <strong>Application ID</strong></li>
			<li>In API Keys: copy your <strong>Search-Only API Key</strong> (for the frontend) and your <strong>Admin API Key</strong> (for indexing only; never expose in the browser)</li>
		</ul>
		
		<h3>2. Index your content</h3>
		<p>Build a script or use the docs site’s approach: a script that outputs records (title, url, category, content) and uploads them to Algolia. Example for a docs site:</p>
		<CodeBlock code={`# Install the Algolia client (for the indexing script only)
pnpm add algoliasearch

# Set credentials (use Admin API Key for indexing; never commit)
export ALGOLIA_APP_ID="your-app-id"
export ALGOLIA_ADMIN_KEY="your-admin-api-key"
export ALGOLIA_INDEX_NAME="your-index-name"

# Run your indexing script (e.g. node scripts/index-docs.js)
node scripts/index-docs.js`} language="bash" />
		<p>Each record should have at least <code>objectID</code>, <code>title</code>, <code>url</code>, <code>category</code>, and <code>content</code> so the Search component can display and link results. Run the script after content changes (e.g. in CI or locally before deploy).</p>
		
		<h3>3. Enable Algolia in your app</h3>
		<p><strong>Astro (this docs site):</strong> Set environment variables so the Search component picks them up. The component reads <code>PUBLIC_ALGOLIA_APP_ID</code>, <code>PUBLIC_ALGOLIA_SEARCH_KEY</code>, and <code>PUBLIC_ALGOLIA_INDEX_NAME</code>. If both App ID and Search Key are set, Algolia is used automatically with local fallback.</p>
		<CodeBlock code={`# .env (never commit real keys)
PUBLIC_ALGOLIA_APP_ID=your-app-id
PUBLIC_ALGOLIA_SEARCH_KEY=your-search-only-api-key
PUBLIC_ALGOLIA_INDEX_NAME=your-index-name

# Optional: force-enable even if you want to rely on env elsewhere
# PUBLIC_ALGOLIA_ENABLED=true`} language="bash" />
		<p><strong>Or pass props:</strong> You can pass <code>useAlgolia={true}</code>, <code>algoliaAppId</code>, <code>algoliaApiKey</code>, and <code>algoliaIndexName</code> to the Search component instead of using env vars.</p>
		<p><strong>Svelte / Vanilla:</strong> The scaffold ships local search only. To add Algolia, include the Algolia client (or use a small backend that proxies search), maintain a search index (e.g. the same record shape), and either call Algolia from your existing search UI logic or adapt the docs site’s Search.astro client script pattern (Algolia first, local fallback on error).</p>
		
		<h3>4. Analytics</h3>
		<p>When Algolia is enabled, the Search component sends <strong>click analytics</strong> (which result was clicked after which query) so you can see popular queries and results in the Algolia dashboard. Search requests use <code>clickAnalytics: true</code> so Algolia can track and improve relevance.</p>
	</section>
	
	<section>
		<h2>Accessibility</h2>
		<p>The Search component includes comprehensive accessibility features:</p>
		<ul>
			<li><strong>ARIA Roles:</strong> <code>role="dialog"</code>, <code>role="listbox"</code>, <code>role="option"</code></li>
			<li><strong>ARIA Labels:</strong> Descriptive labels for all interactive elements</li>
			<li><strong>Keyboard Navigation:</strong> Full keyboard support for all interactions</li>
			<li><strong>Focus Management:</strong> Focus trapping and restoration</li>
			<li><strong>Screen Reader Support:</strong> Proper announcements and labels</li>
			<li><strong>Live Regions:</strong> Search results announced to screen readers</li>
		</ul>
		<p><strong>Svelte & Vanilla:</strong> <a href="/docs/svelte/components/search">Svelte</a> · Vanilla: same HTML and BEM as in Usage above; add JS for Cmd+K and Algolia.</p>
	</section>
</DocsLayout>

<style>
	/* Search trigger matches navbar size (base .search__trigger already has same padding/min) */
	.search-doc-example {
		display: flex;
		align-items: center;
		gap: var(--spacing-4);
	}
	@media (width <= 1023px) {
		.search-doc-example .search__trigger {
			width: auto;
			justify-content: center;
		}
		.search-doc-example .search__trigger-text,
		.search-doc-example .search__kbd {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip-path: inset(50%);
			white-space: nowrap;
			border: 0;
		}
	}
	kbd {
		display: inline-block;
		padding: var(--spacing-0-125) var(--spacing-0-375);
		background-color: var(--background-alt);
		border: var(--outline-width) solid var(--border);
		border-radius: var(--radius);
		font-family: var(--font-family-mono);
		font-size: var(--font-size-xs);
		line-height: 1;
	}
</style>
